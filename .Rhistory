# libraries ---------------------------------------------------------------
library(tidyverse)
library(lubridate)
library(data.table)
library(fastDummies)
current_year = "2023"
current_quarter = "Q1"
# load ppm data -----------------------------------------------------------
ppm_raw = data.table::fread("P:/OBI_abstracted_data/Current_Data/data/input/program_improvement.csv")
# load site_id site_name crosswalk ----------------------------------------
site_id_crosswalk = data.table::fread("P:/OBI_abstracted_data/Current_Data/data/input/analytictable_abs_export.csv") %>% distinct(site_id, site_name)
# merge for site names ----------------------------------------------------
ppm_w_site_name = left_join(ppm_raw, site_id_crosswalk, by = c("site_id"))
# data processing ---------------------------------------------------------
## multi-select variables -------------------------------------------------
### first remove {} from all multi-select var -----------------------------
ppm_gsub = ppm_w_site_name %>% mutate(
qi_proj_barrier = gsub("[{}]", "", quarter_two_choice_barriers_e),
dystocia_barrier = gsub("[{}]", "", qi_work_barrier_e),
huddle_alt_structure = gsub("[{}]", "", huddle_alternative_e),
teambirth_add_on = gsub("[{}]", "", add_on_components_e),
obi_vag_birth_activity = gsub("[{}]", "", primary_vaginal_birth_activity_e),
cesarean_review = gsub("[{}]", "", process_details_e),
prov_ces_report = gsub("[{}]", "", who_receives_report_e)
)
### dummy columns for all -------------------------------------------------
ppm_dummies = dummy_cols(
.data = ppm_gsub,
select_columns = c(
"qi_proj_barrier",
"dystocia_barrier",
"huddle_alt_structure",
"teambirth_add_on",
"obi_vag_birth_activity",
"cesarean_review",
'prov_ces_report'
),
split = "|"
)
# drop unnecessary var ----------------------------------------------------
ppm_var = ppm_dummies %>% select(site_name, site_id, year_no:prov_ces_report_5, -c(qi_proj_barrier:prov_ces_report))
# add lead nurse ----------------------------------------------------------
lead_nurse = data.table::fread(
"P:/OBI hospital and provider/OBI Hospital Information/site_nurse_leads_2023.csv",
col.names = c("site_name", "lead_nurse", "site_id")
) %>% select(site_id, lead_nurse)
ppm_final = left_join(ppm_var, lead_nurse, by = c("site_id"))
View(ppm_final)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
?scale_color_gradientn
?ggplot2::scale_color_gradientn
library(obstinit)
library(ggforce)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth) %>% mutate(test_alert = ifelse(
p_chart_alert == "Above UCL",
"Above UCL",
ifelse(shift_line == "Shift", "Shift", "No alert")),
text_color = case_when(test_alert == "Above UCL" ~ 1,
test_alert == "No alert" ~ -1,
test_alert == "Shift" ~ 0),
point_color_2 = case_when(test_alert == "Above UCL" ~ OBI.color::prim_pink(),
test_alert == "Shift" ~ "#f8b434",
TRUE ~ OBI.color::prim_dark_blue()))
library(obstinit)
library(ggforce)
source("C:/repos/Semi_annual_meetings/spring_2023/code/thea/data_processing.R")
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth) %>% mutate(test_alert = ifelse(
p_chart_alert == "Above UCL",
"Above UCL",
ifelse(shift_line == "Shift", "Shift", "No alert")),
text_color = case_when(test_alert == "Above UCL" ~ 1,
test_alert == "No alert" ~ -1,
test_alert == "Shift" ~ 0),
point_color_2 = case_when(test_alert == "Above UCL" ~ OBI.color::prim_pink(),
test_alert == "Shift" ~ "#f8b434",
TRUE ~ OBI.color::prim_dark_blue()))
ctrl_chart = ctrl_df %>% plot_ctrl_chart() +
#scale_color_gradient(low = OBI.color::prim_med_blue(), high = "red")
scale_color_steps2(low = OBI.color::prim_dark_blue(),
mid = "#f8b434",
high = OBI.color::prim_pink())
ctrl_chart
test = ggplot(aes(x = date_var), data = ctrl_df) +
geom_link2(aes(y = rate, color = text_color), linewidth = 1) +
scale_color_gradient2(low = OBI.color::prim_dark_blue(),
mid = "#f8b434",
high = OBI.color::prim_pink()) +
geom_point(aes(y = rate, fill = point_color_2), size = 3, shape = 21, stroke = 0) +
scale_fill_identity() +
theme_bw()
test
test = ggplot(aes(x = date_var), data = ctrl_df) +
geom_link2(aes(y = rate, color = text_color), linewidth = 1) +
scale_color_gradientn(colors = c(OBI.color::prim_dark_blue(), "#f8b434", OBI.color::prim_pink())) +
geom_point(aes(y = rate, fill = point_color_2), size = 3, shape = 21, stroke = 0) +
scale_fill_identity() +
theme_bw()
test
test = ggplot(aes(x = date_var), data = ctrl_df) +
geom_link2(aes(y = rate, color = text_color), linewidth = 1) +
scale_color_gradientn(colors = c(OBI.color::prim_teal, OBI.color::prim_dark_blue(), "#f8b434", OBI.color::prim_pink())) +
geom_point(aes(y = rate, fill = point_color_2), size = 3, shape = 21, stroke = 0) +
scale_fill_identity() +
theme_bw()
test = ggplot(aes(x = date_var), data = ctrl_df) +
geom_link2(aes(y = rate, color = text_color), linewidth = 1) +
scale_color_gradientn(colors = c(OBI.color::prim_teal(), OBI.color::prim_dark_blue(), "#f8b434", OBI.color::prim_pink())) +
geom_point(aes(y = rate, fill = point_color_2), size = 3, shape = 21, stroke = 0) +
scale_fill_identity() +
theme_bw()
test
test = ggplot(aes(x = date_var), data = ctrl_df) +
geom_link2(aes(y = rate, color = text_color), linewidth = 1) +
scale_color_gradientn(colors = c(OBI.color::prim_dark_blue(), "#f8b434", OBI.color::prim_pink())) +
geom_point(aes(y = rate, fill = point_color_2), size = 3, shape = 21, stroke = 0) +
scale_fill_identity() +
theme_bw()
test
OBI.color::all_colors(show_color = T)
roxygen2::roxygenise()
setwd("C:/repos/obstinit")
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::install_github("obianalysts-umich/obstinit")
devtools::install_github("obianalysts-umich/obstinit")
library(obstinit)
library(ggforce)
install.packages("ggforce")
install.packages("ggforce")
install.packages("ggforce")
install.packages("ggforce")
install.packages("ggforce")
install.packages("ggforce")
library(obstinit)
library(ggforce)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
library(tidyverse)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
View(ctrl_df)
roxygen2::roxygenise()
devtools::install_github("obianalysts-umich/obstinit")
devtools::install_github("obianalysts-umich/obstinit")
devtools::install_github("obianalysts-umich/obstinit")
library(obstinit)
library(ggforce)
library(tidyverse)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
View(ctrl_df)
roxygen2::roxygenise()
devtools::install_github("obianalysts-umich/obstinit")
devtools::install_github("obianalysts-umich/obstinit")
library(obstinit)
library(ggforce)
library(tidyverse)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
roxygen2::roxygenise()
devtools::install_github("obianalysts-umich/obstinit")
structure_data
structure_data()
obstinit::structure_data
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
library(tidyverse)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
library(obstinit)
ctrl_df = obi_cohort %>% structure_data(infant_dob_dt, cesarean, birth)
