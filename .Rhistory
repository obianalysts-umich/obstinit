# libraries ---------------------------------------------------------------
library(tidyverse)
library(lubridate)
library(data.table)
library(fastDummies)
current_year = "2023"
current_quarter = "Q1"
# load ppm data -----------------------------------------------------------
ppm_raw = data.table::fread("P:/OBI_abstracted_data/Current_Data/data/input/program_improvement.csv")
# load site_id site_name crosswalk ----------------------------------------
site_id_crosswalk = data.table::fread("P:/OBI_abstracted_data/Current_Data/data/input/analytictable_abs_export.csv") %>% distinct(site_id, site_name)
# merge for site names ----------------------------------------------------
ppm_w_site_name = left_join(ppm_raw, site_id_crosswalk, by = c("site_id"))
# data processing ---------------------------------------------------------
## multi-select variables -------------------------------------------------
### first remove {} from all multi-select var -----------------------------
ppm_gsub = ppm_w_site_name %>% mutate(
qi_proj_barrier = gsub("[{}]", "", quarter_two_choice_barriers_e),
dystocia_barrier = gsub("[{}]", "", qi_work_barrier_e),
huddle_alt_structure = gsub("[{}]", "", huddle_alternative_e),
teambirth_add_on = gsub("[{}]", "", add_on_components_e),
obi_vag_birth_activity = gsub("[{}]", "", primary_vaginal_birth_activity_e),
cesarean_review = gsub("[{}]", "", process_details_e),
prov_ces_report = gsub("[{}]", "", who_receives_report_e)
)
### dummy columns for all -------------------------------------------------
ppm_dummies = dummy_cols(
.data = ppm_gsub,
select_columns = c(
"qi_proj_barrier",
"dystocia_barrier",
"huddle_alt_structure",
"teambirth_add_on",
"obi_vag_birth_activity",
"cesarean_review",
'prov_ces_report'
),
split = "|"
)
# drop unnecessary var ----------------------------------------------------
ppm_var = ppm_dummies %>% select(site_name, site_id, year_no:prov_ces_report_5, -c(qi_proj_barrier:prov_ces_report))
# add lead nurse ----------------------------------------------------------
lead_nurse = data.table::fread(
"P:/OBI hospital and provider/OBI Hospital Information/site_nurse_leads_2023.csv",
col.names = c("site_name", "lead_nurse", "site_id")
) %>% select(site_id, lead_nurse)
ppm_final = left_join(ppm_var, lead_nurse, by = c("site_id"))
View(ppm_final)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
write.csv(
ppm_final,
file = paste0(
"J:/Data Analytics/PPM/processed_data/",
current_year,
"/",
current_quarter,
"/processed_ppm_",
format(Sys.Date(), "%m.%d.%Y"),
".csv"
),
row.names = F,
na = ""
)
?length
test_vec = c(1,2,3)
length(test_vec)
l1_vec = c(1)
length(l1_vec)
rep(l1_vec, 2)
roxygen2::roxygenise()
setwd("C:/repos/obstinit")
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
roxygen2::roxygenise()
devtools::load_all(".")
plot_ctrl_chart
