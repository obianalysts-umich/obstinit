View(planned_ces_fetal_cond)
planned_ces_fetal_cond = obi_cohort %>% filter(planned_ces_fet_cond_txt != "") %>% count(planned_ces_fet_cond_txt)
planned_ces_fetal_cond = obi_cohort %>% filter(planned_ces_fet_cond_txt != "") %>% mutate(planned_ces_fet_cond_txt = toupper(planned_ces_fet_cond_txt)) %>% count(planned_ces_fet_cond_txt) #TON of macrosomia
planned_ces_fetal_cond = obi_cohort %>% filter(planned_ces_fet_cond_txt != "") %>% mutate(planned_ces_fet_cond_txt = toupper(planned_ces_fet_cond_txt)) %>% count(planned_ces_fet_cond_txt) %>% mutate(totla_n = sum(n)) #TON of macrosomia/LGA, good amount of breech, good amount of non-reassuring fetal testing
planned_ces_mat_cond = obi_cohort %>% filter(planned_ces_mat_cond_txt != "") %>% mutate(planned_ces_mat_cond_txt = toupper(planned_ces_mat_cond_txt)) %>% count(planned_ces_mat_cond_txt) %>% mutate(totla_n = sum(n))
View(planned_ces_mat_cond)
obi_cohort %>% count(planned_ces_prim_indic_cd)
?write.csv
library(xlsx)
?write.xlsx()
write.xlsx(planned_ces_fetal_cond,
file = "P:/Data Management/yearly_programming_changes/2023_2024/planned_ces_ind_free_text_check.xlsx",
sheetName = "FETAL conditions")
planned_ces_fetal_cond = obi_cohort %>% filter(planned_ces_fet_cond_txt != "") %>% mutate(planned_ces_fet_cond_txt = toupper(planned_ces_fet_cond_txt)) %>% count(planned_ces_fet_cond_txt) #TON of macrosomia/LGA (almost 70%), good amount of breech, good amount of non-reassuring fetal testing
planned_ces_mat_cond = obi_cohort %>% filter(planned_ces_mat_cond_txt != "") %>% mutate(planned_ces_mat_cond_txt = toupper(planned_ces_mat_cond_txt)) %>% count(planned_ces_mat_cond_txt)
write.xlsx(planned_ces_fetal_cond,
file = "P:/Data Management/yearly_programming_changes/2023_2024/planned_ces_ind_free_text_check.xlsx",
sheetName = "FETAL conditions",
row.names = F)
write.xlsx(
planned_ces_mat_cond,
file = "P:/Data Management/yearly_programming_changes/2023_2024/planned_ces_ind_free_text_check.xlsx",
sheetName = "MATERNAL conditions",
append = T,
row.names = F
)
obi_sites = obi_cohort %>% group_by(site_name) %>% summarise(
birth_vol = sum(birth),
ces_vol = sum(cesarean),
planned_ces_vol = sum(
ifelse(
planned_mode_of_delivery_cd == 2 &
mode_of_delivery_cd %in% c(5, 6),
1,
0
)
),
overall_ces_rate = ces_vol / birth_vol,
prop_planned_ces = planned_ces_vol / birth_vol
)
View(obi_sites)
lm(ces_rate ~ prop_planned_ces, data = obi_sites)
lm(overall_ces_rate ~ prop_planned_ces, data = obi_sites)
model = lm(overall_ces_rate ~ prop_planned_ces, data = obi_sites)
tidy_model = broom::tidy(model)
tidy_model
library(highcharter)
library(ggeffects)
plot(obi_sites$prop_planned_ces, obi_sites$overall_ces_rate)
?ggpredict
ggpredict(model)
ggpred = ggpredict(model)
plot(ggpred)
library(highcharter)
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate))
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model, "line", hcaes(x = prop_planned_ces, y = .fitted))
View(model)
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model, "line", hcaes(x = prop_planned_ces, y = fitted.values))
model$fitted.values
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model, "line", hcaes(x = prop_planned_ces, y = fitted.values))
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model, "line", hcaes(x = prop_planned_ces, y = .fitted))
model_arr = arrange(augment(model), prop_planned_ces)
library(broom)
model_arr = arrange(augment(model), prop_planned_ces)
View(model_arr)
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model_arr, "line", hcaes(x = prop_planned_ces, y = .fitted))
hchart(obi_sites, "scatter", hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model_arr, "line", hcaes(x = prop_planned_ces, y = .fitted), marker = F)
tidy_model
model = lm(overall_ces_rate_pct ~ prop_planned_ces_pct, data = obi_sites)
obi_sites = obi_cohort %>% group_by(site_name) %>% summarise(
birth_vol = sum(birth),
ces_vol = sum(cesarean),
planned_ces_vol = sum(
ifelse(
planned_mode_of_delivery_cd == 2 &
mode_of_delivery_cd %in% c(5, 6),
1,
0
)
),
overall_ces_rate = ces_vol / birth_vol,
overall_ces_rate_pct = round(overall_ces_rate*100, digits = 1),
prop_planned_ces = planned_ces_vol / birth_vol,
prop_planned_ces_pct = round(prop_planned_ces*100, digits = 1)
)
model = lm(overall_ces_rate_pct ~ prop_planned_ces_pct, data = obi_sites)
tidy_model = tidy(model)
tidy_model
model_arr = arrange(augment(model), prop_planned_ces)
model_arr = arrange(augment(model), prop_planned_ces_pct)
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces, y = overall_ces_rate)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces, y = .fitted),
marker = F)
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F)
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(title = list(text = "Proportion of Cesareans that are planned"))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%"))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(text = paste0("There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p = ", , ")"))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(text = paste0("There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p = ", ")"))
format_pval_fun = function(p_val) {
if (p_val < 0.0001) {
"<0.0001"
}
else
(return(round(p_val, digits = 3)))
}
View(tidy_model)
View(tidy_model)
p_val = tidy_model %>% filter(term = "prop_planned_ces_pct")
p_val = tidy_model %>% filter(term == "prop_planned_ces_pct")
View(p_val)
p_val = tidy_model %>% filter(term == "prop_planned_ces_pct") %>% pull(p.value)
p_val = tidy_model %>% filter(term == "prop_planned_ces_pct") %>% pull(p.value) %>% format_pval_fun()
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(text = paste0("There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ", p_val, ")"))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(line = list(tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}%")))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}%")))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.ces_rate_pct}%")))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F) %>% hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>% hc_add_series(
model_arr,
"arearange",
hcaes(
x = prop_planned_ces_pct,
low = .fitted - 2 * .se.fit,
high = .fitted + 2 * .se.fit
),
linkedTo = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
View(model_arr)
?augment
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>% hc_add_series(
model_arr,
"arearange",
hcaes(
x = prop_planned_ces_pct,
low = .fitted - 2 * .hat,
high = .fitted + 2 * .hat
),
linkedTo = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>% hc_add_series(
model_arr,
"arearange",
hcaes(
x = prop_planned_ces_pct,
low = .fitted - 2 * .std.resid,
high = .fitted + 2 * .std.resid
),
linkedTo = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>% hc_add_series(
model_arr,
"arearange",
hcaes(
x = prop_planned_ces_pct,
low = .fitted - 2 * .resid,
high = .fitted + 2 * .resid
),
linkedTo = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>% hc_add_series(
model_arr,
"arearange",
hcaes(
x = prop_planned_ces_pct,
low = .fitted - 2 * .sigma,
high = .fitted + 2 * .sigma
),
linkedTo = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"There is a significant, positive relationship between the proportion of NTSV Cesareans that are planned and the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
plot(obi_sites$prop_planned_ces_pct, obi_sites$overall_ces_rate_pct)
plot(ggpred)
plot(obi_sites$prop_planned_ces_pct, obi_sites$overall_ces_rate_pct)
plot(ggpred)
View(tidy_model)
estimate = tidy_model %>% filter(term == "prop_planned_ces_pct") %>% pull(estimate)
estimate = tidy_model %>% filter(term == "prop_planned_ces_pct") %>% pull(estimate) %>% round(digits = 3)
estimate = tidy_model %>% filter(term == "prop_planned_ces_pct") %>% pull(estimate) %>% round(digits = 1)
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"A 1% increase in the proportion of NTSV Cesareans that are planned is associated with a ", estimate, "% increase in the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"A 1% increase in the proportion of NTSV Cesareans that are planned is associated with a ", estimate, "% increase in the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
)) %>% hc_plotOption(line = list(tooltip = F))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"A 1% increase in the proportion of NTSV Cesareans that are planned is associated with a ", estimate, "% increase in the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
)) %>% hc_plotOptions(line = list(tooltip = F))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"A 1% increase in the proportion of NTSV Cesareans that are planned is associated with a ", estimate, "% increase in the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
)) %>% hc_plotOptions(line = list(tooltip = list(headerFormat = "", pointFormat = "")))
hchart(obi_sites,
"scatter",
hcaes(x = prop_planned_ces_pct, y = overall_ces_rate_pct)) %>% hc_add_series(
model_arr,
"line",
hcaes(x = prop_planned_ces_pct, y = .fitted),
marker = F,
id = "fit"
) %>%  hc_xAxis(
title = list(text = "Proportion of NTSV Cesareans that are planned"),
labels = list(format = "{value}%")
) %>% hc_yAxis(title = list(text = "NTSV Cesarean rate"),
labels = list(format = "{value}%")) %>% hc_title(
text = paste0(
"A 1% increase in the proportion of NTSV Cesareans that are planned is associated with a ", estimate, "% increase in the overall NTSV Cesarean rate (p ",
p_val,
")"
)
) %>% hc_plotOptions(scatter = list(
tooltip = list(headerFormat = "", pointFormat = "<b>Site name: {point.site_name}</b><br><b>Proportion NTSV Cesareans that are planned: </b>{point.prop_planned_ces_pct}% <br><b>NTSV Cesarean rate: </b>{point.overall_ces_rate_pct}%")
)) %>% hc_plotOptions(line = list(tooltip = list(headerFormat = "", pointFormat = "")))
